# COLORS
RED="\e[0;31m"
GRN="\e[0;32m"
FIN="\e[0m"

# CROSS
docker_cross(){
rm -f Dockerfile
rm -f docker-compose.yml
tee docker-compose.yml <<EOF
version: '3.6'
services:

  arm-img-builder:
  #  build: .  #uncomment for building
    image: pttrr/arm-img-builder:latest
    privileged: true
    container_name: arm-img-builder
    tty: true
    restart: always
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
      - /dev:/dev
      - ./:/images
    
EOF

tee Dockerfile <<EOF
FROM ubuntu:20.04

RUN apt-get update && \
    DEBIAN_FRONTEND=noninteractive  apt-get install -y --no-install-recommends \
        ca-certificates \
        apt-transport-https \
        binfmt-support \
        qemu \
        qemu-user-static \
        qemu-system-x86 \
        dosfstools \
        rsync \
        wget \
        lsof \
        build-essential \
        bison \
        xz-utils \
        dirmngr \
        parted \
        systemd \
        systemd-sysv \
        debootstrap \
        kmod \
        dbus \
        udev \
        procps \
        nano \
        unzip \
        git \
        bc \
        curl \
        dialog \
        patch \
        zip \
        rsync \
        cpio \
        flex \
        libssl-dev \
        libncurses5-dev \
        fakeroot \
        swig \
        aria2 \
        pv \
        toilet \
        figlet \
        crossbuild-essential-arm64 \
        crossbuild-essential-armel \
        gcc-arm-none-eabi \
        gcc-aarch64-linux-gnu \
        distro-info-data \
        lsb-release \
        python \
        python-dev \
        python3-distutils \
        python3-dev \
        lz4 \
        lzop \
        libfdt-dev \
        device-tree-compiler \
        && apt-get update \
        && apt-get upgrade -y \
        && apt-get clean \
	&& rm -rf /var/lib/apt/lists/*

WORKDIR /build

RUN git clone https://github.com/pyavitz/rpi-img-builder \
    && git clone https://github.com/pyavitz/debian-image-builder \
    && wget -cq --show-progress https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/Makefile \
    && mkdir -p docker \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/setup \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/pull \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/update \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/function
    
CMD ["/bin/bash"]

EOF
}

# NATIVE
docker_native(){
rm -f Dockerfile
rm -f docker-compose.yml
tee docker-compose.yml <<EOF
version: '3.6'
services:

  arm-img-builder:
  #  build: .  #uncomment for building
    image: pttrr/arm-img-builder:latest
    privileged: true
    container_name: arm-img-builder
    tty: true
    restart: always
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
      - /dev:/dev
      - ./:/images
    
EOF

tee Dockerfile <<EOF
FROM ubuntu:20.04

RUN apt-get update && \
    DEBIAN_FRONTEND=noninteractive  apt-get install -y --no-install-recommends \
        ca-certificates \
        apt-transport-https \
        binfmt-support \
        qemu \
        dosfstools \
        rsync \
        wget \
        lsof \
        build-essential \
        bison \
        xz-utils \
        parted \
        systemd \
        systemd-sysv \
        debootstrap \
        kmod \
        dbus \
        udev \
        procps \
        nano \
        unzip \
        git \
        bc \
        curl \
        dialog \
        patch \
        unzip \
        rsync \
        cpio \
        flex \
        libssl-dev \
        libncurses5-dev \
        fakeroot \
        swig \
        aria2 \
        pv \
        toilet \
        figlet \
        distro-info-data \
        lsb-release \
        python \
        python-dev \
        python3-distutils \
        python3-dev \
        lz4 \
        lzop \
        libfdt-dev \
        device-tree-compiler \
        binutils-arm-none-eabi \
        gcc-arm-none-eabi \
        libnewlib-arm-none-eabi \
        libnewlib-dev \
        libstdc++-arm-none-eabi-newlib \ 
        qemu-user-static \
        zip \
        && apt-get update \
        && apt-get upgrade -y \
        && apt-get clean \
	&& rm -rf /var/lib/apt/lists/*

WORKDIR /build

RUN git clone https://github.com/pyavitz/rpi-img-builder \
    && git clone https://github.com/pyavitz/debian-image-builder \
    && wget -cq --show-progress https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/Makefile \
    && mkdir -p docker \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/setup \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/pull \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/update \
    && wget -cq --show-progress -P docker https://raw.githubusercontent.com/pyavitz/arm-img-builder/main/docker/function
    
CMD ["/bin/bash"]

EOF
}

##Building the container
docker_build(){
rm -f docker-compose.yml
tee docker-compose.yml <<EOF
version: '3.6'
services:

  arm-img-builder:
    build: .  #uncomment for building
    image: pttrr/arm-img-builder:latest
    privileged: true
    container_name: arm-img-builder
    tty: true
    restart: always
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
      - /dev:/dev
      - ./:/images
    
EOF
}
